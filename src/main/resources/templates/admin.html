<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>admin</title>
</head>
<body class="broaden">
<div id="admin" class="container">
    <var-popup position="left" v-model:show="List">
        <div class="popup">
            <var-tabs
                    style="--tabs-background:rgba(0,0,0,0.8);"
                    class="popup-body"
                    inactive-color="rgb(255, 255, 255, 0.7)"
                    layout-direction="vertical"
                    v-model:active="show">
                <var-tab name="0" style="--tab-font-size:2rem" @click="Activity(0)">系统状态</var-tab>
                <var-tab name="1" style="--tab-font-size:2rem" @click="Activity(1)">用户管理</var-tab>
                <var-tab name="2" style="--tab-font-size:2rem" @click="Activity(2)">商品管理</var-tab>
                <var-tab name="3" style="--tab-font-size:2rem" @click="Activity(3)">订单管理</var-tab>
                <var-tab name="4" style="--tab-font-size:2rem" @click="Activity(4)">评论管理</var-tab>
                <var-tab name="5" style="--tab-font-size:2rem" @click="logout">登出</var-tab>
                <var-tab name="6" style="--tab-font-size:2rem" @click="about">关于</var-tab>
                <var-tab :disabled="true"></var-tab>
                <var-tab :disabled="true"></var-tab>
                <var-tab :disabled="true"></var-tab>
                <var-tab :disabled="true"></var-tab>
            </var-tabs>
        </div>
    </var-popup>
    <success v-model:show="SuccessText"></success>
    <error v-model:show="ErrorText" :code="code" :message="message"></error>

    <div v-if="show == 0" class="fig">
        <div class="left Padding BST"></div>
        <div class="left Main">
            <div style="float: left;padding: 1.5rem 0 1.5rem 0.5rem">
                <var-button text class="BST" @click="List=true"><var-icon name="menu"/></var-button>
            </div>
            <div class="title"><h3 style="letter-spacing:0.8rem">系统状态</h3></div>
            <div style="width: 73rem;height: 38.5rem;padding: 0.8rem;">
                <div style="width: 73rem;height: 38.5rem;background: #fff8">
                    <div class="text"><h3>欢迎你:{{ name }}管理员</h3></div>
                    <div class="text"><h3>现在是:{{ time }}</h3></div>
                    <div class="text"><h3>通讯使延:{{ delay }}</h3></div>
                    <div class="text"><h3>当前活跃的用户人数为:{{ tokens }}</h3></div>
                    <div class="text"><h3>系统状态:</h3></div>
                    <div class="text" style="text-align: center;width: 73rem">
                        <table>
                            <thead>
                            <td style="width: 36.5rem;padding: 0 6rem"><var-progress style="--progress-font-size: 2rem" mode="circle" label :value="cpu" :line-width="20" :size="240" /></td>
                            <td style="width: 36.5rem;padding: 0 6rem"><var-progress style="--progress-font-size: 2rem" mode="circle" label :value="mem" :line-width="20" :size="240" /></td>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div style="width: 17.5rem;height: 48.7rem;float: left;margin: 5rem 0 0 0;background: #0000"></div>
    </div>


    <div v-if="show == 1" class="fig">
        <div class="left Padding BST"></div>
        <div class="left Main">
            <div style="float: left;padding: 1.5rem 0 1.5rem 0.5rem">
                <var-button text class="BST" @click="List=true"><var-icon name="menu"/></var-button>
            </div>
            <div class="title"><h3 style="letter-spacing:0.8rem">用户管理</h3></div>
            <div style="width: 73rem;height: 3rem;padding: 0.5rem">
                <var-button text class="left" style="height: 3rem" @click="addUser"><var-icon name="plus"/></var-button>
                <var-input style="float: left;width: 21.5rem;margin: 0 0 0 1rem;
                           --input-input-height: 2rem;--field-decorator-blur-color:#fff8;--field-decorator-line-size: 0.15rem;
                           --field-decorator-text-color:#fff"
                           variant="outlined" size="small" placeholder="名称" v-model="UsersName"></var-input>
                <role-select style="margin: 0 1rem" :role="Role"></role-select>
                <var-button text class="left" style="height: 3rem" @click="selectUser"><var-icon name="magnify"/></var-button>
                <var-button text class="right" style="height: 3rem" @click="deleteUsers"><var-icon name="delete" /></var-button>
            </div>
            <div class="tableBody">
                <user-table-head style="width: 73rem;background: #fff8"></user-table-head>
<!--                <user-table-body class="scroll" style="width: 73rem;height: 31rem;background: #fff8" :users="users"></user-table-body>-->
                <div class="scroll" style="width: 73rem;height: 31rem;background: #fff8" @scroll="UsersHandleScroll">
                <table :style='`transform:translateY(${UsersOffsetY}px)`'>
                    <var-checkbox-group ref='users' v-model='SelectUIDs'>
                        <tbody style='height: 4rem' v-for='item in VirUsers' :key='item.uid'>
                        <tr>
                            <td style='text-align: center;width: 4.8rem'><var-checkbox :checked-value='item.uid' @click="Sort(item.uid,SelectUIDs)"></var-checkbox></td>
                            <td style='text-align: center;width: 9.8rem;word-break: break-all'>{{ item.uid }}</td>
                            <td style='text-align: center;width: 9.8rem;word-break: break-all'>{{ item.username }}</td>
                            <td style='text-align: center;width: 9.8rem;word-break: break-all'>{{ item.role }}</td>
                            <td style='text-align: center;width: 9.8rem;word-break: break-all'>{{ item.name }}</td>
                            <td style='text-align: center;width: 9.5rem;word-break: break-all'><var-button text @click='getUserDetail(item.uid)'><var-icon name='view' /></var-button></td>
                            <td style='text-align: center;width: 9.5rem;word-break: break-all'><var-button text @click='updateUser(item.uid)'><var-icon name='cog' /></var-button></td>
                            <td style='text-align: center;width: 10rem;word-break: break-all'><var-button text @click='deleteUser(item.uid)'><var-icon name='delete' /></var-button></td>
                        </tr>
                        </tbody>
                    </var-checkbox-group>
                </table>
                </div>
            </div>
        </div>
        <div style="width: 17.5rem;height: 48.7rem;float: left;margin: 5rem 0 0 0;background: #0000"></div>
        <var-popup style="width: 40rem;padding: 2rem" position="center" v-model:show="UserDetail">
            <div style="width: 100%;text-align: center"><h1>用户详细信息</h1></div>
            <div><h3>UID: {{ user.uid }}</h3></div>
            <div><h3>账号: {{ user.username }}</h3></div>
            <div><h3>身份: {{ user.role }}</h3></div>
            <div><h3>名称: {{ user.name }}</h3></div>
            <div><h3>电话: {{ user.tel }}</h3></div>
            <div><h3>地址: {{ user.address }}</h3></div>
            <div><h3>备注: {{ user.info }}</h3></div>
        </var-popup>
    </div>


    <div v-if="show == 2" class="fig">
        <div class="left Padding BST"></div>
        <div class="left Main">
            <div style="float: left;padding: 1.5rem 0 1.5rem 0.5rem">
                <var-button text class="BST" @click="List=true"><var-icon name="menu"/></var-button>
            </div>
            <div class="title"><h3 style="letter-spacing:0.8rem">商品管理</h3></div>
            <div style="width: 73rem;height: 3rem;padding: 0.5rem">
                <var-input style="float: left;width: 21.5rem;margin: 0 1rem;
                           --input-input-height: 2rem;--field-decorator-blur-color:#fff8;--field-decorator-line-size: 0.15rem;
                           --field-decorator-text-color:#fff"
                           variant="outlined" size="small" placeholder="商品名" v-model="ProductName"></var-input>
                <var-button text class="left" style="height: 3rem" @click="selectProduct"><var-icon name="magnify"/></var-button>
            </div>
            <div class="tableBody">
                <product-table-head style="width: 73rem;background: #fff8"></product-table-head>
<!--                <product-table-body class="scroll" style="width: 73rem;height: 31rem;background: #fff8" :products="products"></product-table-body>-->
                <div class="scroll" style="width: 73rem;height: 31rem;background: #fff8" @scroll="ProductsHandleScroll">
                    <table :style='`transform:translateY(${ProductsOffsetY}px)`'>
                        <var-checkbox-group ref='products' v-model='SelectPIDs'>
                            <tbody style="height: 4rem;" v-for='item in VirProducts' :key='item.pid'>
                            <tr>
                                <td style='text-align: center;width: 4.8rem'><var-checkbox :checked-value='item.pid' @click="Sort(item.pid,SelectPIDs)"></var-checkbox></td>
                                <td style='text-align: center;width: 18.6rem;word-break: break-all'>{{ item.pid }}</td>
                                <td style='text-align: center;width: 18.6rem;word-break: break-all'>{{ item.uid }}</td>
                                <td style='text-align: center;width: 18.6rem;word-break: break-all'>{{ item.name }}</td>
                                <td style='text-align: center;width: 12.4rem;word-break: break-all'><var-button text @click='getProductDetail(item.pid)'><var-icon name='view' /></var-button></td>
                            </tr>
                            </tbody>
                        </var-checkbox-group>
                    </table>
                </div>
            </div>
        </div>
        <div style="width: 17.5rem;height: 48.7rem;float: left;margin: 5rem 0 0 0;background: #0000"></div>
        <var-popup style="width: 40rem;padding: 2rem" position="center" v-model:show="ProductDetail">
            <div style="width: 100%;text-align: center"><h1>商品详细信息</h1></div>
            <div><h3>PID: {{ product.pid }}</h3></div>
            <div><h3>商品名: {{ product.name }}</h3></div>
            <div><h3>价格: {{ product.price }}</h3></div>
            <div><h3>评分: {{ product.score }}</h3></div>
            <div><h3>备注: {{ product.info }}</h3></div>
            <div><h3>图片:</h3></div>
            <div><img style="width: 35rem;height: 20rem;" :src="img(product.image) "></div>
        </var-popup>
    </div>


    <div v-if="show == 3" class="fig">
        <div class="left Padding BST"></div>
        <div class="left Main">
            <div style="float: left;padding: 1.5rem 0 1.5rem 0.5rem">
                <var-button text class="BST" @click="List=true"><var-icon name="menu"/></var-button>
            </div>
            <div class="title"><h3 style="letter-spacing:0.8rem">订单管理</h3></div>
            <div style="width: 73rem;height: 3rem;padding: 0.5rem">
<!--                <var-button text disabled class="left" style="height: 3rem"><var-icon name="plus"/></var-button>-->
                <state-select style="margin: 0 1rem"></state-select>
                <var-button text class="left" style="height: 3rem" @click="selectOrder"><var-icon name="magnify"/></var-button>
<!--                <var-button text class="right" style="height: 3rem" @click="deleteOrders"><var-icon name="delete" /></var-button>-->
            </div>
            <div class="tableBody">
                <order-table-head style="width: 73rem;background: #fff8"></order-table-head>
<!--                <order-table-body class="scroll" style="width: 73rem;height: 31rem;background: #fff8" :orders="orders"></order-table-body>-->
                <div class="scroll" style="width: 73rem;height: 31rem;background: #fff8" @scroll="OrdersHandleScroll">
                    <table :style='`transform:translateY(${OrdersOffsetY}px)`'>
                        <var-checkbox-group ref='products' v-model='SelectOIDs'>
                            <tbody style="height: 4rem;" v-for='item in VirOrders' :key='item.oid'>
                            <tr>
                                <td style='text-align: center;width: 4.8rem'><var-checkbox :checked-value='item.oid'></var-checkbox></td>
                                <td style='text-align: center;width: 13.6rem;word-break: break-all'>{{ item.oid }}</td>
                                <td style='text-align: center;width: 13.7rem;word-break: break-all'>{{ item.tid }}</td>
                                <td style='text-align: center;width: 13.7rem;word-break: break-all'>{{ item.state }}</td>
                                <td style='text-align: center;width: 13.7rem;word-break: break-all'>{{ item.date }}</td>
                                <td style='text-align: center;width: 13.6rem;word-break: break-all'><var-button text @click='getOrderDetail(item.oid)'><var-icon name='view' /></var-button></td>
                            </tr>
                            </tbody>
                        </var-checkbox-group>
                    </table>
                </div>
            </div>
        </div>
        <div style="width: 17.5rem;height: 48.7rem;float: left;margin: 5rem 0 0 0;background: #0000"></div>
        <var-popup position="center" style="height: 40rem;" v-model:show="OrderDetail">
            <div >
                <div style="margin: 1rem 3rem 0">
                    <h3>买家编号:{{ order.bid }}</h3><br/>
                    <h3>商家编号:{{ order.sid }}</h3><br/>
                    <h3>骑手编号:{{ order.did }}</h3><br/>
                    <h3>备注:{{ order.info }}</h3><br/>
                    <h3>订单列表:</h3><br/>
                </div>
                <listing-table-head style="width: 40rem;margin: 0 3rem;background: #0004"></listing-table-head>
                <listing-table-body class="scroll" style="width: 40rem;height: 20rem;margin: 0 3rem;background: #0004" :listings="listings"></listing-table-body>
            </div>
        </var-popup>
    </div>


    <div v-if="show == 4" class="fig">
        <div class="left Padding BST"></div>
        <div class="left Main">
            <div style="float: left;padding: 1.5rem 0 1.5rem 0.5rem">
                <var-button text class="BST" @click="List=true"><var-icon name="menu"/></var-button>
            </div>
            <div class="title"><h3 style="letter-spacing:0.8rem">评论管理</h3></div>
            <div style="width: 73rem;height: 3rem;padding: 0.5rem">
                <var-input style="float: left;width: 21.5rem;margin: 0 0 0 1rem;
                           --input-input-height: 2rem;--field-decorator-blur-color:#fff8;--field-decorator-line-size: 0.15rem;
                           --field-decorator-text-color:#fff"
                           variant="outlined" size="small" placeholder="商家" v-model="ReviewUID"></var-input>
                <var-button text class="left" style="height: 3rem" @click="selectReview"><var-icon name="magnify"/></var-button>
                <var-button text class="right" style="height: 3rem" @click="deleteReviews"><var-icon name="delete" /></var-button>
            </div>
            <div class="tableBody">
                <review-table-head style="width: 73rem;background: #fff8"></review-table-head>
<!--                <review-table-body class="scroll" style="width: 73rem;height: 31rem;background: #fff8" :reviews="review"></review-table-body>-->
                <div class="scroll" style="width: 73rem;height: 31rem;background: #fff8" @scroll="ReviewsHandleScroll">
                    <table :style='`transform:translateY(${ReviewsOffsetY}px)`'>
                        <var-checkbox-group ref='products' v-model='SelectRIDs'>
                            <tbody style="height: 4rem;" v-for='item in VirReviews' :key='item.rid'>
                            <tr>
                                <td style='text-align: center;width: 4.8rem'><var-checkbox :checked-value='item.rid' @click="Sort(item.rid,SelectRIDs)"></var-checkbox></td>
                                <td style='text-align: center;width: 11.3rem;word-break: break-all'>{{ item.rid }}</td>
                                <td style='text-align: center;width: 11.3rem;word-break: break-all'>{{ item.oid }}</td>
                                <td style='text-align: center;width: 11.3rem;word-break: break-all'>{{ item.uid }}</td>
                                <td style='text-align: center;width: 11.4rem;word-break: break-all'><var-ellipsis style="max-width: 9.7rem">{{ item.detail }}</var-ellipsis></td>
                                <td style='text-align: center;width: 11.4rem;word-break: break-all'><var-button text @click='getReviewDetail(item.rid)'><var-icon name='view' /></var-button></td>
                                <td style='text-align: center;width: 11.5rem;word-break: break-all'><var-button text @click='deleteReview(item.rid)'><var-icon name='delete' /></var-button></td>
                            </tr>
                            </tbody>
                        </var-checkbox-group>
                    </table>
                </div>
            </div>
        </div>
        <div style="width: 17.5rem;height: 48.7rem;float: left;margin: 5rem 0 0 0;background: #0000"></div>
        <var-popup style="width: 40rem;padding: 2rem" position="center" v-model:show="ReviewDetail">
            <div style="width: 100%;text-align: center"><h1>评论详细信息</h1></div>
            <div><h3>RID: {{ review.rid }}</h3></div>
            <div><h3>订单号: {{ review.oid }}</h3></div>
            <div><h3>商家号: {{ review.uid }}</h3></div>
            <div><h3>评分: {{ review.score }}</h3></div>
            <div><h3>时间: {{ review.date }}</h3></div><br/>
            <div><h3>评论: {{ review.detail }}</h3></div>
        </var-popup>
    </div>
</div>

<link rel="stylesheet" type="text/css" href="css/admin.css">
<link rel="stylesheet" type="text/css" href="css/general.css">

<link rel="stylesheet" type="text/css" href="css/jquery-confirm-min.css">
<script src="js/jquery-1.9.1-min.js"></script>
<script src="js/jquery.cookie-1.4.1-min.js"></script>
<script src="js/jquery-confirm-min.js"></script>
<script src="js/vue-3.3.4-global-min.js"></script>
<script src="js/utils.js"></script>
<script src="js/api.js"></script>

<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<!-- 桌面端兼容 -->
<script src="https://cdn.jsdelivr.net/npm/@varlet/touch-emulator/iife.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@varlet/ui/umd/varlet.js"></script>
<script>
    var baseURL = API.baseURL = $.cookie("baseURL")
    var { createApp } = Vue;
    var app;
    var container = createApp({
        data() {
            return {
                "show": 0,
                "TODO": 0,
                "pagedata": "system",
                "name": $.cookie("name"),
                "time": Utils.getTime("yyyy-MM-dd hh:mm:ss"),
                "List": false,
                "SuccessText": false,
                "ErrorText": false,
                "code": 100,
                "message": "",
                "delay": 0,
                "tokens": 0,
                "online": 0,
                "cpu": 0,
                "mem": 0,
                "ScrollTime": new Date().getTime(),

                "user": "",
                "users": [],
                "UserDetail": false,
                "UsersName": "",
                "Role": "",
                "SelectUIDs": [],
                "VirUsers": [],
                "UsersScrollH":0,
                "UsersShowNum":0,
                "UsersOffsetY":0,

                "product": "",
                "products": [],
                "ProductDetail": false,
                "ProductName": "",
                "SelectPIDs": [],
                "VirProducts": [],
                "ProductsScrollH":0,
                "ProductsShowNum":0,
                "ProductsOffsetY":0,

                "order": "",
                "orders":[],
                "OrderDetail": false,
                "OrderState": "",
                "SelectOIDs": [],
                "VirOrders": [],
                "OrdersScrollH":0,
                "OrdersShowNum":0,
                "OrdersOffsetY":0,
                "listings": [],

                "review": "",
                "reviews": [],
                "ReviewDetail": false,
                "ReviewUID": null,
                "SelectRIDs": [],
                "VirReviews": [],
                "ReviewsScrollH":0,
                "ReviewsShowNum":0,
                "ReviewsOffsetY":0,
            }
        },
        methods: {
            // Test() {
            //     alert(this.SelectUIDs);
            // },
            getSystemInfo() {
                var startTime = new Date().getTime();
                $.ajax({
                    type: "POST",
                    url: baseURL + "system/get",
                    contentType: "application/json",
                    data: JSON.stringify({"token": $.cookie("token")}),
                    dataType: "json"
                }).always(function (data) {
                    if (data.code === 0) {
                        var now = new Date().getTime();
                        // 时钟不同步 不使用伺服器下发的时间戳
                        // var delay = now - data.time;
                        // 使用RTT/2估算，需要注意setInterval的一秒时延
                        // RTT / 2 = (now - startTime - 1000) / 2
                        var delay = Math.floor((now - startTime - 1000) / 2);
                        var online = Utils.getTime("MM月dd天hh时mm分ss秒", now - data.start);
                        app.delay = (delay < 60 ? "优" : delay < 150 ? "良" : delay < 400 ? "一般" : "差") + "(" + delay + "ms)";
                        while (online.substring(0, 2) === "00") {
                            online = online.substring(3);
                        }
                        app.online = online;
                        app.tokens = data.tokens;
                        app.cpu = data.cpu;
                        app.mem = data.mem;
                    } else {
                        app.delay = "失去连接";
                        app.tokens = 0;
                        app.online = 0;
                        app.cpu = "0%";
                        app.mem = "0%";
                    }
                })
            },
            Activity(TODO) {
                if(TODO === 0) {

                } else if (TODO === 1) {
                    API.getUser(null, null, null, (result) => {
                        if (result.code === 0) {
                            app.pagedata = "users";
                            app.SelectUIDs=[];
                            app.users = result.users;
                        }
                    })
                } else if (TODO === 2) {
                    API.getProduct(null, null, null, (result) => {
                        if (result.code === 0) {
                            app.pagedata = "products";
                            app.SelectPIDs=[];
                            app.products = result.products;
                        }
                    })
                } else if (TODO === 3) {
                    API.getOrder(null, null, null, (result) => {
                        if (result.code === 0) {
                            app.pagedata = "orders";
                            app.SelectOIDs=[];
                            app.orders = result.orders;
                        }
                    })
                } else if (TODO === 4) {
                    API.getReview(null, null, null, (result) => {
                        if (result.code === 0) {
                            app.pagedata = "reviews";
                            app.SelectRIDs=[];
                            app.reviews = result.reviews;
                        }
                    })
                }
            },
            Refresh() {
                if (this.pagedata === "users") {
                    API.getUser(null,this.Role, this.UsersName,(result) => {
                        if(result.code === 0) {
                            app.users=result.users;
                        }
                    })
                } else if (this.pagedata === "products") {
                    API.getProduct(null, null, this.ProductName,(result) => {
                        if(result.code === 0) {
                            app.products=result.products;
                        }
                    })
                } else if (this.pagedata === "orders") {
                    API.getOrder(null, null, null, (result) => {
                        if(result.code === 0) {
                            app.orders=result.orders;
                        }
                    })
                } else if (this.pagedata === "reviews") {
                    API.getReview(null, null, null, (result) => {
                        if(result.code === 0) {
                            app.reviews=result.reviews;
                        }
                    })
                }
            },
            Sort(value,list) {
                var index=list.indexOf(value);
                if(index === -1)
                    list.push(value);
                else
                    list.splice(index,1);
                list=list.sort((a,b) => a-b);
            },

            addUser() {
                $.confirm({
                    title: "添加用户",
                    content:
                        "<div>" +
                        "<div><h3 id='1' style='display: inline'>账号: </h3><input id='addUsername' style='width: 40%;display: inline'></div>" +
                        "<div><h3 style='display: inline'>密码: </h3><input id='addPassword' style='width: 40%;display: inline'></div>" +
                        "<div><h3 style='display: inline'>名称: </h3><input id='addName' style='width: 40%;display: inline'></div>" +
                        "<div><h3 style='display: inline'>身份: </h3>" +
                        "<select id='addRole'>" +
                        "    <option value='buyer'>用户</option>" +
                        "    <option value='shop'>商家</option>" +
                        "    <option value='delivery'>骑手</option>" +
                        "    <option value='admin'>管理员</option>" +
                        "</select>" +
                        "</div>" +
                        "</div>",
                    buttons: {
                        confirm: {
                            text: "确认",
                            action: function() {
                                var user = {};
                                var result;
                                user.username = this.$content.find("#addUsername").val();
                                user.password = this.$content.find("#addPassword").val();
                                user.name = this.$content.find("#addName").val();
                                user.role = this.$content.find("#addRole").val();
                                user.image = "Test.png";
                                result = API.addUser(user);
                                if (result.code === 0) {
                                    app.SuccessText = true;
                                    app.Refresh();
                                } else {
                                    app.code = result.code;
                                    app.message = result.message;
                                    app.ErrorText = true;
                                }
                            }
                        },
                        cancel: {
                            text: "取消"
                        }
                    },
                    boxWidth: "30%",
                    useBootstrap: false,
                    theme: "material",
                    animationBounce: 1.5
                })
            },
            selectUser() {
                $.confirm({
                    title: "查找",
                    content:
                        "<div style='display: flex;align-items: center'><h3 style='display: inline'>根据:UID</h3>" +
                        "<h3 style='display: inline'>查询:</h3><input id='UID' style='width: 30%;display: inline'>" +
                        "</div>",
                    buttons: {
                        confirm: {
                            text: "执行",
                            action: function () {
                                var UID = this.$content.find("#UID").val();
                                if(UID === "") {
                                     API.getUser(null, null, null, (result)=>{
                                         app.users=result.users;
                                     });
                                } else {
                                    API.getUser(UID, this.role, this.name, (result)=>{
                                        if(result.code===0)
                                            app.users = result.user == null ? [] : [result.user];
                                        else {
                                            app.code = result.code;
                                            app.message = result.message;
                                            app.ErrorText = true;
                                        }
                                    });
                                }
                            }
                        },
                        cancel: {
                            text: "取消"
                        }
                    },
                    boxWidth: "30%",
                    useBootstrap: false,
                    theme: "material",
                    animationBounce: 1.5
                })
            },
            getUserDetail(uid) {
                API.getUser(uid, null, null, (result)=>{
                    if (result.code === 0) {
                        app.user=result.user;
                        app.UserDetail=true;
                    } else {
                        app.code = result.code;
                        app.message = result.message;
                        app.ErrorText = true;
                    }
                });
            },
            updateUser(uid) {
                var result = API.getUser(uid,null,null,null);
                var user;
                if (result.code === 0) {
                    user = result.user;
                    $.confirm({
                        title: "修改用户",
                        content:
                            // "<img :src='img(user.image)'>" +
                            "<div>" +
                            "<div><h3 id='1' style='display: inline'>编号: </h3>" +
                            "    <input value='" + user.uid + "' id='updateUid' style='width: 40%;display: inline' readonly>" +
                            "</div>" +
                            "<div><h3 style='display: inline'>身份: </h3>" +
                            "<select id='updateRole'>" +
                            "    <option " + (user.role === "buyer" ? "selected" : "") + " value='buyer'>用户</option>" +
                            "    <option " + (user.role === "shop" ? "selected" : "") + " value='shop'>商家</option>" +
                            "    <option " + (user.role === "delivery" ? "selected" : "") + " value='delivery'>骑手</option>" +
                            "</select>" +
                            "</div>" +
                            "<div><h3 id='1' style='display: inline'>账号: </h3>" +
                            "    <input value='" + user.username + "' id='updateUsername' style='width: 40%;display: inline' readonly>" +
                            "</div>" +
                            "<div><h3 style='display: inline'>密码: </h3>" +
                            "    <input id='updatePassword' style='width: 40%;display: inline'>" +
                            "</div>" +
                            "<div><h3 style='display: inline'>姓名: </h3>" +
                            "    <input value='" + user.name + "' id='updateName' style='width: 40%;display: inline'>" +
                            "</div>" +
                            "<div><h3 style='display: inline'>电话: </h3>" +
                            "    <input value='" + user.tel + "' id='updateTel' style='width: 40%;display: inline'>" +
                            "</div>" +
                            "<div><h3 style='display: inline'>地址: </h3>" +
                            "    <input value='" + user.address + "' id='updateAddress' style='width: 40%;display: inline'>" +
                            "</div>" +
                            "<div><h3 style='display: inline'>备注: </h3>" +
                            "    <input value='" + user.info + "' id='updateInfo' style='width: 40%;display: inline'>" +
                            "</div>" +
                            "<div><h3 style='display: inline'>头像: </h3>" +
                            "   <input type='file' id='updateImage' accept='image/*'>" +
                            "</div>" +
                            "</div>",
                        buttons: {
                            confirm: {
                                text: "确认",
                                action: function() {
                                    if(this.$content.find("#updateImage").val() !== "") {
                                        alert(this.$content.find("#updateImage").val());
                                        user.image=API.Upload(document.getElementById("updateImage")).fileName;
                                    }
                                    user.role = this.$content.find("#updateRole").val();
                                    user.password = this.$content.find("#updatePassword").val();
                                    user.name = this.$content.find("#updateName").val();
                                    user.tel = this.$content.find("#updateTel").val();
                                    user.address = this.$content.find("#updateAddress").val();
                                    user.info = this.$content.find("#updateInfo").val();
                                    var result = API.updateUser(user);
                                    if (result.code === 0) {
                                        app.SuccessText = true;
                                        app.Refresh();
                                    } else {
                                        app.code = result.code;
                                        app.message = result.message;
                                        app.ErrorText = true;
                                    }
                                }
                            },
                            cancel: {
                                text: "取消"
                            }
                        },
                        boxWidth: "30%",
                        useBootstrap: false,
                        theme: "material",
                        animationBounce: 1.5,
                    })
                } else {
                    app.code = result.code;
                    app.message = result.message;
                    app.ErrorText = true;
                }
            },
            deleteUsers() {
                var users = app.SelectUIDs;
                for(var i=0; i<users.length; i++) {
                    var result = API.deleteUser(users[i], null)
                    if (i === users.length - 1) {
                        if (result.code === 0) {
                            app.SuccessText = true;
                            app.SelectUIDs = [];
                            app.Refresh();
                        } else {
                            app.code = result.code;
                            app.message = result.message;
                            app.ErrorText = true;
                        }
                    }
                }
            },
            deleteUser(uid) {
                var result = API.getUser(uid, null, null, null);
                var user = result.user
                $.alert({
                    title: "删除用户",
                    content:
                        "<div style='width: 100%'>" +
                        "<div style='width: 100%'>" +
                        "<h3 style='display: inline'>这将</h3>" +
                        "<h2 style='color: red;display: inline'>不可逆</h2>" +
                        "<h3 style='display: inline'>地删除"+ user.name +"(Uid: " + user.uid + ")</h3>" +
                        "</div>" +
                        "<div><h3>确认要继续执行吗?</h3></div>" +
                        "</div>",
                    buttons:{
                        confirm: {
                            text: "删除",
                            btnClass: "btn-red",
                            action: function() {
                                result = API.deleteUser(uid);
                                if (result.code === 0) {
                                    app.SuccessText = true;
                                    app.Refresh();
                                } else {
                                    app.code = result.code;
                                    app.message = result.message;
                                    app.ErrorText = true;
                                }
                            }
                        },
                        cancel: {
                            text: "取消"
                        }
                    },
                    boxWidth: "25%",
                    useBootstrap: false,
                    theme: "material",
                    animationBounce: 1.5,
                })
            },
            UsersHandleScroll(e) {
                if(new Date().getTime()-this.ScrollTime>10) {
                    var scrollTop=e.target.scrollTop;
                    this.UsersOffsetY=scrollTop-(scrollTop%(4*14));
                    this.VirUsers=this.users.slice(
                        Math.floor(scrollTop/(4*14)),
                        Math.floor(scrollTop/(4*14))+this.UsersShowNum
                    )
                    // console.log(scrollTop,this.UsersShowNum,scrollTop/(4*14)+this.UsersShowNum,this.VirUsers)
                    this.ScrollTime=new Date().getTime();
                }
            },

            selectProduct() {
                $.confirm({
                    title: "查找",
                    content:
                        "<div style='display: flex;align-items: center'><h3 style='display: inline'>根据:PID</h3>" +
                        "<h3 style='display: inline'>查询:</h3><input id='PID' style='width: 30%;display: inline'>" +
                        "</div>",
                    buttons: {
                        confirm: {
                            text: "执行",
                            action: function () {
                                var PID = this.$content.find("#PID").val();
                                if(PID === "") {
                                    API.getProduct(null, null, null, (result)=>{
                                        app.products = result.products;
                                    });
                                } else {
                                    API.getProduct(PID, null, this.name, (result)=>{
                                        if(result.code===0)
                                            app.products = result.product == null ? [] : [result.product];
                                        else {
                                            app.code = result.code;
                                            app.message = result.message;
                                            app.ErrorText = true;
                                        }
                                    });
                                }
                            }
                        },
                        cancel: {
                            text: "取消"
                        }
                    },
                    boxWidth: "30%",
                    useBootstrap: false,
                    theme: "material",
                    animationBounce: 1.5
                })
            },
            getProductDetail(pid) {
                API.getProduct(pid, null, null, (result)=>{
                    if (result.code === 0) {
                        app.product=result.product;
                        app.ProductDetail=true;
                    } else {
                        app.code = result.code;
                        app.message = result.message;
                        app.ErrorText = true;
                    }
                });
            },
            ProductsHandleScroll(e) {
                if(new Date().getTime()-this.ScrollTime>10) {
                    var scrollTop=e.target.scrollTop;
                    this.ProductsOffsetY=scrollTop-(scrollTop%(4*14));
                    this.VirProducts=this.products.slice(
                        Math.floor(scrollTop/(4*14)),
                        Math.floor(scrollTop/(4*14))+this.ProductsShowNum
                    )
                    this.ScrollTime=new Date().getTime();
                }
            },

            selectOrder() {
                $.confirm({
                    title: "查找",
                    content:
                        "<div style='display: flex;align-items: center'><h3 style='display: inline'>根据:OID</h3>" +
                        "<h3 style='display: inline'>查询:</h3><input id='OID' style='width: 30%;display: inline'>" +
                        "</div>",
                    buttons: {
                        confirm: {
                            text: "执行",
                            action: function () {
                                var OID = this.$content.find("#OID").val();
                                if(OID === "") {
                                    API.getOrder(null, null, null, (result)=>{
                                        app.orders = result.orders;
                                    });
                                } else {
                                    API.getOrder(OID, null, null, (result)=>{
                                        if(result.code===0)
                                            app.orders = result.order == null ? [] : [result.order];
                                        else {
                                            app.code = result.code;
                                            app.message = result.message;
                                            app.ErrorText = true;
                                        }
                                    });

                                }
                            }
                        },
                        cancel: {
                            text: "取消"
                        }
                    },
                    boxWidth: "30%",
                    useBootstrap: false,
                    theme: "material",
                    animationBounce: 1.5
                })
            },
            getOrderDetail(oid) {
                API.getOrder(oid, null, null, (result)=>{
                    if (result.code === 0) {
                        app.order=result.order;
                        app.listings=result.order.listings;
                        app.OrderDetail=true;
                    } else {
                        app.code = result.code;
                        app.message = result.message;
                        app.ErrorText = true;
                    }
                });
            },
            OrdersHandleScroll(e) {
                if(new Date().getTime()-this.ScrollTime>10) {
                    var scrollTop=e.target.scrollTop;
                    this.OrdersOffsetY=scrollTop-(scrollTop%(4*14));
                    this.VirOrders=this.orders.slice(
                        Math.floor(scrollTop/(4*14)),
                        Math.floor(scrollTop/(4*14))+this.OrdersShowNum
                    )
                    this.ScrollTime=new Date().getTime();
                }
            },

            selectReview() {
                $.confirm({
                    title: "查找",
                    content:
                        "<div style='display: flex;align-items: center'><h3 style='display: inline'>根据:RID</h3>" +
                        "<h3 style='display: inline'>查询:</h3><input id='UID' style='width: 30%;display: inline'>" +
                        "</div>",
                    buttons: {
                        confirm: {
                            text: "执行",
                            action: function () {
                                var RID = this.$content.find("#RID").val();
                                if(RID === "") {
                                    API.getReview(RID, null, null, (result)=>{
                                        app.reviews = result.reviews;
                                    });
                                } else {
                                    API.getReview(RID, null, null, (result)=>{
                                        if(result.code===0)
                                            app.reviews = result.review == null ? [] : [result.review];
                                        else {
                                            app.code = result.code;
                                            app.message = result.message;
                                            app.ErrorText = true;
                                        }
                                    });
                                }
                            }
                        },
                        cancel: {
                            text: "取消"
                        }
                    },
                    boxWidth: "30%",
                    useBootstrap: false,
                    theme: "material",
                    animationBounce: 1.5
                })
            },
            getReviewDetail(rid) {
                API.getReview(rid, null, null, (result)=>{
                    if (result.code === 0) {
                        app.review=result.review;
                        app.ReviewDetail=true;
                    } else {
                        app.code = result.code;
                        app.message = result.message;
                        app.ErrorText = true;
                    }
                });
            },
            deleteReviews() {
                var reviews = app.SelectRIDs;
                for(var i=0; i<reviews.length; i++) {
                    var result = API.deleteReview(reviews[i], null)
                    if (i === reviews.length -1) {
                        if (result.code === 0) {
                            app.SuccessText = true;
                            app.SelectRIDs=[];
                            app.Refresh();
                        } else {
                            app.code = result.code;
                            app.message = result.message;
                            app.ErrorText = true;
                        }
                    }
                }
            },
            deleteReview(rid) {
                $.alert({
                    title: "删除评论",
                    content:
                        "<div style='width: 100%'>" +
                        "<div style='width: 100%'>" +
                        "<h3 style='display: inline'>这将</h3>" +
                        "<h2 style='color: red;display: inline'>不可逆</h2>" +
                        "<h3 style='display: inline'>地删除该评论</h3>" +
                        "</div>" +
                        "<div><h3>确认要继续执行吗?</h3></div>" +
                        "</div>",
                    buttons:{
                        confirm: {
                            text: "删除",
                            btnClass: "btn-red",
                            action: function() {
                                result = API.deleteReview(rid,null);
                                if (result.code === 0) {
                                    app.SuccessText = true;
                                    app.Refresh();
                                } else {
                                    app.code = result.code;
                                    app.message = result.message;
                                    app.ErrorText = true;
                                }
                            }
                        },
                        cancel: {
                            text: "取消"
                        }
                    },
                    boxWidth: "25%",
                    useBootstrap: false,
                    theme: "material",
                    animationBounce: 1.5,
                })
            },
            ReviewsHandleScroll(e) {
                if(new Date().getTime()-this.ScrollTime>10) {
                    var scrollTop=e.target.scrollTop;
                    this.ReviewsOffsetY=scrollTop-(scrollTop%(4*14));
                    this.VirReviews=this.reviews.slice(
                        Math.floor(scrollTop/(4*14)),
                        Math.floor(scrollTop/(4*14))+this.ReviewsShowNum
                    )
                    this.ScrollTime=new Date().getTime();
                }
            },

            //待修改
            img(image) { return "img/"+image; },
            logout() {
                $.ajax({
                    type: "POST",
                    url: baseURL + "to_logout",
                    // 阻塞线程避免登出数据与
                    // 访问根的请求到达次序不同
                    data: JSON.stringify({
                        "token":$.cookie("token"),
                    }),
                    contentType: "application/json",
                    dataType: "json",
                    async: false
                });
                var keys = document.cookie.match(/[^ =;]+(?=\=)/g);
                if (keys) {
                    for (var i = keys.length; i--;)
                        document.cookie = keys[i] + '=0;expires=' + new Date(0).toUTCString() + ";path=/;";
                }
                sessionStorage.clear();
                window.location.href = baseURL;
            },
            about() {window.open($.cookie("baseURL") + "about.html");},
        },
        watch: {
            users(newusers,oldusers) {
                this.UsersOffsetY=0;
                this.UsersScrollH=app.users.length*(4*14);
                this.UsersShowNum=Math.floor(31/4)+4;
                this.VirUsers=app.users.slice(0,this.UsersShowNum);
                this.ScrollTime=new Date().getTime();
            },
            products(newproduct,oldproduct) {
                this.ProductsOffsetY=0;
                this.ProductsScrollH=app.products.length*(4*14);
                this.ProductsShowNum=Math.floor(31/4)+4;
                this.VirProducts=app.products.slice(0,this.ProductsShowNum);
                this.ScrollTime=new Date().getTime();
            },
            orders(neworder,oldorder) {
                this.OrdersOffsetY=0;
                this.OrdersScrollH=app.orders.length*(4*14);
                this.OrdersShowNum=Math.floor(31/4)+4;
                this.VirOrders=app.orders.slice(0,this.OrdersShowNum);
                this.ScrollTime=new Date().getTime();
            },
            reviews(newreview,oldreview) {
                this.ReviewsOffsetY=0;
                this.ReviewsScrollH=app.reviews.length*(4*14);
                this.ReviewsShowNum=Math.floor(31/4)+4;
                this.VirReviews=app.reviews.slice(0,this.ReviewsShowNum);
                this.ScrollTime=new Date().getTime();
            },
            
            UsersName(newUsersName, oldUsersName) {
                API.getUser(null, this.Role, newUsersName, (result)=>{
                    app.users = result.users;
                });
            },
            Role(newRole, oldRole) {
                API.getUser(null, newRole, this.UsersName, (result)=>{
                    app.users = result.users;
                });
            },
            ProductName(newProductName, oldProductName) {
                API.getProduct(null, null, newProductName, (result)=>{
                    app.products = result.products;
                });
            },
            OrderState(newOrderState, oldOrderState) {
                API.getOrder(null, null, null, (result)=>{
                    if(newOrderState !== "")
                        app.orders = result.orders.filter(item => (item.state === newOrderState));
                    else
                        app.orders = result.orders;
                });
            },
            ReviewUID(newReviewUID, oldReviewUID) {
                API.getReview(null, null, newReviewUID, (result)=>{
                    app.reviews=result.reviews;
                })
            },
        },
        mounted() {
            app=this;
            this.timer=setInterval(()=>{
                app.time=Utils.getTime("yyyy-MM-dd hh:mm:ss");
            },1000)
        },
        beforeDestroy() {
            if(this.timer) {
                clearInterval(this.timer);
            }
        },
        components: {
            "RoleSelect": {
                props: ["role"],
                template:
                    "      <var-select style='float: left;width: 21.5rem;--select-scroller-background:#0000;" +
                    "                  --field-decorator-outlined-small-padding-top:0.7rem;--field-decorator-outlined-small-padding-bottom:0.7rem;" +
                    "                  --field-decorator-blur-color:#fff8;--field-decorator-line-size: 0.15rem;--field-decorator-text-color:#fff'" +
                    "                  variant='outlined' size='small' placeholder='身份' v-model='select'>" +
                    "        <var-option style='--option-height:2rem' @click='res(\"\")'    label='' value='' />" +
                    "        <var-option style='--option-height:2rem' @click='res(\"buyer\")' label='用户' value='buyer' />" +
                    "        <var-option style='--option-height:2rem' @click='res(\"shop\")' label='商家' value='shop'/>" +
                    "        <var-option style='--option-height:2rem' @click='res(\"delivery\")' label='骑手' value='delivery'/>" +
                    "        <var-option style='--option-height:2rem' @click='res(\"admin\")' label='管理员' value='admin'/>" +
                    "      </var-select>",
                data() {
                    return{
                        "select": this.role,
                    }
                },
                methods: {
                    res(data) {
                        app.Role=data
                    }
                },
            },
            "UserTableHead": {
                template:
                    "<var-table>" +
                    "    <thead>" +
                    "      <tr>" +
                    "        <th style='text-align: center;width: 3.5rem'><var-checkbox></var-checkbox></th>" +
                    "        <th style='text-align: center;width: 50rem'>编号</th>" +
                    "        <th style='text-align: center;width: 50rem'>账号</th>" +
                    "        <th style='text-align: center;width: 50rem'>身份</th>" +
                    "        <th style='text-align: center;width: 50rem'>名称</th>" +
                    "        <th style='text-align: center;width: 50rem'>详细信息</th>" +
                    "        <th style='text-align: center;width: 50rem'>操作</th>" +
                    "        <th style='text-align: center;width: 50rem'>删除</th>" +
                    "      </tr>" +
                    "    </thead>" +
                    "</var-table>"
            },
            "UserTableBody": {
                props: ["users"],
                template:
                    "<var-table>" +
                    "<var-checkbox-group ref='users' v-model='SelectUIDs'>"+
                    "    <tbody v-for='item in users' :key='item.uid'>" +
                    "      <tr>" +
                    "        <td style='text-align: center;width: 3.5rem'><var-checkbox :checked-value='item.uid'></var-checkbox></td>" +
                    "        <td style='text-align: center;width: 50rem;word-break: break-all'>{{ item.uid }}</td>" +
                    "        <td style='text-align: center;width: 55rem;word-break: break-all'>{{ item.username }}</td>" +
                    "        <td style='text-align: center;width: 50rem;word-break: break-all'>{{ item.role }}</td>" +
                    "        <td style='text-align: center;width: 55rem;word-break: break-all'>{{ item.name }}</td>" +
                    "        <td style='text-align: center;width: 35rem;word-break: break-all'><var-button text @click='getUserDetail(item.uid)'><var-icon name='view' /></var-button></td>" +
                    "        <td style='text-align: center;width: 35rem;word-break: break-all'><var-button text @click='updateUser(item.uid)'><var-icon name='cog' /></var-button></td>" +
                    "        <td style='text-align: center;width: 35rem;word-break: break-all'><var-button text @click='deleteUser(item.uid)'><var-icon name='delete' /></var-button></td>" +
                    "      </tr>" +
                    "    </tbody>" +
                    "</var-checkbox-group>" +
                    "</var-table>",
                data() {
                    return {
                        "SelectUIDs": [],
                    }
                },
                watch: {
                    SelectUIDs(newSelectUIDs,oldSelectUIDs) {
                        app.SelectUIDs=this.SelectUIDs.sort((a, b) => a - b);
                    },
                },
                methods: {
                    getUserDetail(uid) { app.getUserDetail(uid) },
                    updateUser(uid) { app.updateUser(uid) },
                    deleteUser(uid) { app.deleteUser(uid) },
                },
            },

            "ProductTableHead": {
                template:
                    "<var-table>" +
                    "    <thead>" +
                    "      <tr>" +
                    "        <th style='text-align: center;width: 3.5rem'><var-checkbox></var-checkbox></th>" +
                    "        <th style='text-align: center;width: 50rem'>编号</th>" +
                    "        <th style='text-align: center;width: 50rem'>商家编号</th>" +
                    "        <th style='text-align: center;width: 50rem'>商品名</th>" +
                    "        <th style='text-align: center;width: 30rem'>详细信息</th>" +
                    "      </tr>" +
                    "    </thead>" +
                    "</var-table>"
            },
            "ProductTableBody": {
                props: ["products"],
                template:
                    "<var-table>" +
                    "<var-checkbox-group ref='products' v-model='SelectPIDs'>"+
                    "    <tbody v-for='item in products' :key='item.pid'>" +
                    "      <tr>" +
                    "        <td style='text-align: center;width: 3.5rem'><var-checkbox :checked-value='item.pid'></var-checkbox></td>" +
                    "        <td style='text-align: center;width: 80rem;word-break: break-all'>{{ item.pid }}</td>" +
                    "        <td style='text-align: center;width: 80rem;word-break: break-all'>{{ item.uid }}</td>" +
                    "        <td style='text-align: center;width: 80rem;word-break: break-all'>{{ item.name }}</td>" +
                    "        <td style='text-align: center;width: 30rem;word-break: break-all'><var-button text @click='getProductDetail(item.pid)'><var-icon name='view' /></var-button></td>" +
                    "        <td style='text-align: center;width: 30rem;word-break: break-all'><var-button text @click='updateProduct(item.pid)'><var-icon name='cog' /></var-button></td>" +
                    "        <td style='text-align: center;width: 30rem;word-break: break-all'><var-button text @click='deleteProduct(item.pid)'><var-icon name='delete' /></var-button></td>" +
                    "      </tr>" +
                    "    </tbody>" +
                    "</var-checkbox-group>"+
                    "</var-table>",
                data() {
                    return {
                        "SelectPIDs": [],
                    }
                },
                watch: {
                    SelectPIDs(newSelectPIDs,oldSelectPIDs) {
                        app.SelectPIDs=this.SelectPIDs.sort((a, b) => a - b);
                    },
                },
                methods: {
                    getProductDetail(pid) { app.getProductDetail(pid) },
                    updateProduct(pid) { app.updateProduct(pid) },
                    deleteProduct(pid) { app.deleteProduct(pid) },
                    updateProductImage(pid) { app.updateProductImage(pid) },
                },
            },

            "StateSelect": {
                template:
                    "      <var-select style='float: left;width: 21.5rem;--select-scroller-background:#0000;" +
                    "                  --field-decorator-outlined-small-padding-top:0.7rem;--field-decorator-outlined-small-padding-bottom:0.7rem;" +
                    "                  --field-decorator-blur-color:#fff8;--field-decorator-line-size: 0.15rem;--field-decorator-text-color:#fff'" +
                    "                  variant='outlined' size='small' placeholder='交易状态' v-model='OrderState'>" +
                    "        <var-option style='--option-height:2rem' @click='res(\"\")'    label='' value='' />" +
                    "        <var-option style='--option-height:2rem' @click='res(\"unpaid\")' label='未支付' value='unpaid' />" +
                    "        <var-option style='--option-height:2rem' @click='res(\"paid\")' label='已支付' value='paid'/>" +
                    "        <var-option style='--option-height:2rem' @click='res(\"received\")' label='已接收' value='received'/>" +
                    "        <var-option style='--option-height:2rem' @click='res(\"delivering\")' label='正配送' value='delivering'/>" +
                    "        <var-option style='--option-height:2rem' @click='res(\"finish\")' label='已完成' value='finish'/>" +
                    "        <var-option style='--option-height:2rem' @click='res(\"cancel\")' label='未完成' value='cancel'/>" +
                    "      </var-select>",
                data() {
                    return{
                        "OrderState": "",
                    }
                },
                methods: {
                    res(data) {
                        app.OrderState=data
                    }
                },
            },
            "OrderTableHead": {
                template:
                    "<var-table>" +
                    "    <thead>" +
                    "      <tr>" +
                    "        <th style='text-align: center;width: 3.5rem'><var-checkbox></var-checkbox></th>" +
                    "        <th style='text-align: center;width: 50rem'>编号</th>" +
                    "        <th style='text-align: center;width: 50rem'>付款凭证</th>" +
                    "        <th style='text-align: center;width: 50rem'>交易状态</th>" +
                    "        <th style='text-align: center;width: 50rem'>时间</th>" +
                    "        <th style='text-align: center;width: 50rem'>详细信息</th>" +
                    "      </tr>" +
                    "    </thead>" +
                    "</var-table>"
            },
            "OrderTableBody": {
                props: ["orders"],
                template:
                    "<var-table>" +
                    "<var-checkbox-group ref='products' v-model='SelectOIDs'>"+
                    "    <tbody v-for='item in orders' :key='item.oid'>" +
                    "      <tr>" +
                    "        <td style='text-align: center;width: 3.5rem'><var-checkbox :checked-value='item.oid'></var-checkbox></td>" +
                    "        <td style='text-align: center;width: 50rem;word-break: break-all'>{{ item.oid }}</td>" +
                    "        <td style='text-align: center;width: 60rem;word-break: break-all'>{{ item.tid }}</td>" +
                    "        <td style='text-align: center;width: 50rem;word-break: break-all'>{{ item.state }}</td>" +
                    "        <td style='text-align: center;width: 50rem;word-break: break-all'>{{ item.date }}</td>" +
                    "        <td style='text-align: center;width: 35rem;word-break: break-all'><var-button text @click='getOrderDetail(item.oid)'><var-icon name='view' /></var-button></td>" +
                    "        <td style='text-align: center;width: 35rem;word-break: break-all'><var-button text @click='updateOrder(item.oid)'><var-icon name='cog' /></var-button></td>" +
                    "        <td style='text-align: center;width: 35rem;word-break: break-all'><var-button text @click='deleteOrder(item.oid)'><var-icon name='delete' /></var-button></td>" +
                    "      </tr>" +
                    "    </tbody>" +
                    "</var-checkbox-group>"+
                    "</var-table>",
                data() {
                    return {
                        "SelectOIDs": [],
                    }
                },
                watch: {
                    SelectOIDs(newSelectOIDs,oldSelectOIDs) {
                        app.SelectOIDs=this.SelectOIDs.sort((a, b) => a - b);
                    },
                },
                methods: {
                    getOrderDetail(oid) { app.getOrderDetail(oid) },
                    updateOrder(oid) { app.updateOrder(oid) },
                    deleteOrder(oid) { app.deleteOrder(oid) },
                },
            },
            "ListingTableHead": {
                template:
                    "<var-table>" +
                    "    <thead>" +
                    "      <tr>" +
                    "        <th style='text-align: center;width: 50rem'>编号</th>" +
                    "        <th style='text-align: center;width: 50rem'>商品号</th>" +
                    "        <th style='text-align: center;width: 50rem'>数量</th>" +
                    "      </tr>" +
                    "    </thead>" +
                    "</var-table>",
            },
            "ListingTableBody": {
                props: ["listings"],
                template:
                    "<var-table>" +
                    "    <tbody v-for='item in listings' :key='item.lid'>" +
                    "      <tr>" +
                    "        <td style='text-align: center;width: 50rem;word-break: break-all'>{{ item.lid }}</td>" +
                    "        <td style='text-align: center;width: 50rem;word-break: break-all'>{{ item.pid }}</td>" +
                    "        <td style='text-align: center;width: 50rem;word-break: break-all'>{{ item.amount }}</td>" +
                    "      </tr>" +
                    "    </tbody>" +
                    "</var-table>",
            },

            "ReviewTableHead": {
                template:
                    "<var-table>" +
                    "    <thead>" +
                    "      <tr>" +
                    "        <th style='text-align: center;width: 3.5rem'><var-checkbox></var-checkbox></th>" +
                    "        <th style='text-align: center;width: 50rem'>编号</th>" +
                    "        <th style='text-align: center;width: 50rem'>订单</th>" +
                    "        <th style='text-align: center;width: 50rem'>商家</th>" +
                    "        <th style='text-align: center;width: 50rem'>评论</th>" +
                    "        <th style='text-align: center;width: 50rem'>详细信息</th>" +
                    "        <th style='text-align: center;width: 50rem'>删除</th>" +
                    "      </tr>" +
                    "    </thead>" +
                    "</var-table>"
            },
            "ReviewTableBody": {
                props: ["reviews"],
                template:
                    "<var-table>" +
                    "    <tbody v-for='item in reviews' :key='item.oid'>" +
                    "      <tr>" +
                    "        <td style='text-align: center;width: 3.5rem'><var-checkbox></var-checkbox></td>" +
                    "        <td style='text-align: center;width: 50rem;word-break: break-all'>{{ item.rid }}</td>" +
                    "        <td style='text-align: center;width: 65rem;word-break: break-all'>{{ item.oid }}</td>" +
                    "        <td style='text-align: center;width: 50rem;word-break: break-all'>{{ item.uid }}</td>" +
                    "        <td style='text-align: center;width: 65rem;word-break: break-all'>{{ item.detail }}</td>" +
                    "        <td style='text-align: center;width: 35rem;word-break: break-all'><var-button text @click='getReviewDetail(item.rid)'><var-icon name='view' /></var-button></td>" +
                    "        <td style='text-align: center;width: 35rem;word-break: break-all'><var-button text @click='updateReview(item.rid)'><var-icon name='cog' /></var-button></td>" +
                    "        <td style='text-align: center;width: 35rem;word-break: break-all'><var-button text @click='deleteReview(item.rid)'><var-icon name='delete' /></var-button></td>" +
                    "      </tr>" +
                    "    </tbody>" +
                    "  </var-table>",
                data() {
                    return {
                        "SelectRIDs": [],
                    }
                },
                watch: {
                    SelectRIDs(newSelectRIDs,oldSelectRIDs) {
                        app.SelectRIDs=this.SelectRIDs.sort((a, b) => a - b);
                    },
                },
                methods: {
                    getReviewDetail(rid) { app.getReviewDetail(rid) },
                    updateReview(rid) { app.updateReview(rid) },
                    deleteReview(rid) { app.deleteReview(rid) },
                },
            },

            "success": {
                template:
                    "        <var-popup :default-style='false'>" +
                    "          <var-result class='result' style='width: 28.5rem' type='success' title='成功' description='提交成功'>" +
                    "            <template #footer>" +
                    "              <div style='text-align: center'>" +
                    "                  <var-button type='success' @click='change'>知道了</var-button>" +
                    "              </div>" +
                    "            </template>" +
                    "          </var-result>" +
                    "        </var-popup>",
                methods: {
                    change() {
                        app.SuccessText=!app.SuccessText;
                    }
                }
            },
            "error": {
                props: ["code","message"],
                template:
                    "        <var-popup :default-style='false'>" +
                    "          <var-result class='result' style='width: 28.5rem' type='error' title='错误' description='提交失败'>" +
                    "            <template #footer>" +
                    "              <div style='text-align: center;margin: 0 0 2rem 0'>" +
                    "                  <h3>错误代码:{{ code }}&emsp;&emsp;&emsp;错误信息:{{ message }}</h3><br/>" +
                    "              </div>" +
                    "              <div style='text-align: center'>" +
                    "                  <var-button type='danger' @click='change'>知道了</var-button>" +
                    "              </div>" +
                    "            </template>" +
                    "          </var-result>" +
                    "        </var-popup>",
                methods: {
                    change() {
                        app.ErrorText=!app.ErrorText;
                    }
                }
            },
        },
    })
    window.setInterval(() => {
        setTimeout(app.getSystemInfo, 0)
    }, 1000);
    container.use(Varlet).mount("#admin");
</script>
</body>
</html>